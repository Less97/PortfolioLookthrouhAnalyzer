@page "/portfolio"
@inject IPortfolioClient PortfolioClient
@using PortfolioModel = PortfolioAnalyzer.Shared.Models.Portfolio

<PageTitle>Portfolio Holdings</PageTitle>

@if (portfolio == null)
{
    <p><em>Loading portfolio...</em></p>
}
else
{
    <div class="page-header">
        <div class="page-title-section">
            <h1>Portfolio Holdings</h1>
            <p class="page-subtitle">Detailed line-by-line breakdown.</p>
        </div>
        <div class="view-mode">
            <span class="mode-label">MODE:</span>
            <span class="mode-value">Market View</span>
        </div>
    </div>

    <div class="holdings-table-container">
        <table class="holdings-table">
            <thead>
                <tr>
                    <th class="text-left">COMPANY</th>
                    <th class="text-right">PRICE</th>
                    <th class="text-right">VALUE</th>
                    <th class="text-center">ALLOCATION</th>
                    <th class="text-right">1Y RETURN</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var position in portfolio.Positions.OrderByDescending(p => p.MarketValue))
                {
                    var allocation = (position.MarketValue / portfolio.TotalMarketValue * 100);
                    <tr>
                        <td class="company-cell">
                            <div class="company-info">
                                <div class="company-avatar">@position.Symbol.Substring(0, 1)</div>
                                <div class="company-details">
                                    <div class="company-symbol">@position.Symbol</div>
                                    <div class="company-name">@position.Security?.Name</div>
                                </div>
                            </div>
                        </td>
                        <td class="text-right">@position.CurrentPrice.ToString("C2")</td>
                        <td class="text-right font-semibold">@position.MarketValue.ToString("C0")</td>
                        <td class="text-center">
                            <div class="allocation-cell">
                                <div class="allocation-bar-bg">
                                    <div class="allocation-bar" style="width: @(allocation)%"></div>
                                </div>
                                <span class="allocation-text">@allocation.ToString("F1")%</span>
                            </div>
                        </td>
                        <td class="text-right return-cell @(position.UnrealizedPnLPercent >= 0 ? "positive" : "negative")">
                            @(position.UnrealizedPnLPercent >= 0 ? "+" : "")@position.UnrealizedPnLPercent.ToString("F1")% (Fund.)
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

@code {
    private PortfolioModel? portfolio;

    protected override async Task OnInitializedAsync()
    {
        portfolio = await PortfolioClient.GetPortfolioAsync();
    }
}

<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 2rem;
    }

    .page-title-section h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: 400;
        color: #1a1a1a;
    }

    .page-subtitle {
        margin: 0.5rem 0 0 0;
        color: #6b7280;
        font-size: 0.95rem;
    }

    .view-mode {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
    }

    .mode-label {
        color: #9ca3af;
    }

    .mode-value {
        color: #1a1a1a;
        font-weight: 500;
    }

    .holdings-table-container {
        background: white;
        border-radius: 12px;
        padding: 0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        overflow: hidden;
    }

    .holdings-table {
        width: 100%;
        border-collapse: collapse;
    }

    .holdings-table thead {
        background: #fafafa;
        border-bottom: 1px solid #e5e7eb;
    }

    .holdings-table th {
        padding: 1rem 1.5rem;
        font-weight: 500;
        font-size: 0.75rem;
        color: #9ca3af;
        letter-spacing: 0.5px;
    }

    .holdings-table td {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid #f3f4f6;
        font-size: 0.95rem;
        color: #1a1a1a;
    }

    .holdings-table tbody tr:last-child td {
        border-bottom: none;
    }

    .holdings-table tbody tr:hover {
        background: #fafafa;
    }

    .text-left {
        text-align: left;
    }

    .text-right {
        text-align: right;
    }

    .text-center {
        text-align: center;
    }

    .font-semibold {
        font-weight: 600;
    }

    .company-cell {
        min-width: 250px;
    }

    .company-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .company-avatar {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background: #f3f4f6;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 1rem;
        color: #6b7280;
    }

    .company-details {
        display: flex;
        flex-direction: column;
    }

    .company-symbol {
        font-weight: 600;
        font-size: 1rem;
        color: #1a1a1a;
        margin-bottom: 0.15rem;
    }

    .company-name {
        font-size: 0.85rem;
        color: #6b7280;
    }

    .allocation-cell {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
    }

    .allocation-bar-bg {
        width: 80px;
        height: 6px;
        background: #f3f4f6;
        border-radius: 3px;
        overflow: hidden;
    }

    .allocation-bar {
        height: 100%;
        background: #1a1a1a;
        border-radius: 3px;
    }

    .allocation-text {
        font-size: 0.85rem;
        font-weight: 500;
    }

    .return-cell {
        font-weight: 500;
    }

    .return-cell.positive {
        color: #10b981;
    }

    .return-cell.negative {
        color: #ef4444;
    }

    @media (max-width: 768px) {
        .holdings-table-container {
            overflow-x: auto;
        }
    }
</style>
