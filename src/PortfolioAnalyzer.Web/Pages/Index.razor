@page "/"
@inject IPortfolioClient PortfolioClient
@using PortfolioModel = PortfolioAnalyzer.Shared.Models.Portfolio

<PageTitle>Executive Summary</PageTitle>

@if (portfolio == null || analytics == null)
{
    <p><em>Loading portfolio data...</em></p>
}
else
{
    <div class="page-header">
        <div class="page-title-section">
            <h1>Executive Summary</h1>
            <p class="page-subtitle">Trailing Twelve Months (TTM) consolidated operating metrics.</p>
        </div>
        <div class="portfolio-value-header">
            <div class="header-label">TOTAL MARKET EQUITY</div>
            <div class="header-value">@portfolio.TotalMarketValue.ToString("C0")</div>
        </div>
    </div>

    <div class="executive-grid">
        <div class="metric-card large">
            <div class="metric-icon">
                <span class="bi bi-bar-chart-line-fill"></span>
            </div>
            <div class="metric-content">
                <div class="metric-label">LOOK-THROUGH REVENUE</div>
                <div class="metric-value">@analytics.TotalRevenue.ToString("C0")</div>
                <div class="metric-change positive">
                    <span class="bi bi-arrow-up"></span> +@analytics.WeightedRevenueGrowth.ToString("F1")% YoY
                </div>
            </div>
        </div>

        <div class="metric-card large">
            <div class="metric-icon">
                <span class="bi bi-cash-coin"></span>
            </div>
            <div class="metric-content">
                <div class="metric-label">LOOK-THROUGH EARNINGS</div>
                <div class="metric-value">@analytics.TotalFreeCashFlow.ToString("C0")</div>
                <div class="metric-change positive">
                    <span class="bi bi-arrow-up"></span> +@analytics.WeightedEarningsGrowth.ToString("F1")% YoY
                </div>
            </div>
        </div>

        <div class="metrics-sidebar">
            <div class="sidebar-metric">
                <div class="sidebar-label">EARNINGS YIELD</div>
                <div class="sidebar-value">@((analytics.TotalFreeCashFlow / portfolio.TotalMarketValue * 100).ToString("F1"))%</div>
                <div class="sidebar-comparison">S&P 500 Avg: ~4.1%</div>
            </div>

            <div class="sidebar-metric">
                <div class="sidebar-label">PROFIT MARGIN</div>
                <div class="sidebar-value">@((analytics.TotalFreeCashFlow / analytics.TotalRevenue * 100).ToString("F1"))%</div>
                <div class="sidebar-comparison">Aggregate Net Margin</div>
            </div>
        </div>
    </div>

    <div class="status-bar">
        <div class="status-text">Consolidated reporting for @portfolio.Positions.Count holdings</div>
        <div class="operational-health">
            <span class="health-indicator"></span>
            Operational Health: Strong
        </div>
    </div>

    <div class="growth-section">
        <div class="growth-header">
            <div class="growth-title">1-YEAR FUNDAMENTAL GROWTH ATTRIBUTION</div>
            <div class="growth-icon">
                <span class="bi bi-box-arrow-up-right"></span>
            </div>
        </div>
        <div class="growth-content">
            <div class="growth-value">+@analytics.WeightedEarningsGrowth.ToString("F1")%</div>
            <div class="growth-label">Portfolio Earnings Growth</div>
            <div class="growth-subtext">Tap to view which companies drove this performance</div>
        </div>
    </div>
}

@code {
    private PortfolioModel? portfolio;
    private PortfolioAnalytics? analytics;

    protected override async Task OnInitializedAsync()
    {
        portfolio = await PortfolioClient.GetPortfolioAsync();
        analytics = await PortfolioClient.GetAnalyticsAsync();
    }
}

<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 2rem;
    }

    .page-title-section h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: 400;
        color: #1a1a1a;
    }

    .page-subtitle {
        margin: 0.5rem 0 0 0;
        color: #6b7280;
        font-size: 0.95rem;
    }

    .portfolio-value-header {
        text-align: right;
    }

    .header-label {
        font-size: 0.75rem;
        color: #9ca3af;
        letter-spacing: 0.5px;
        margin-bottom: 0.25rem;
    }

    .header-value {
        font-size: 2rem;
        font-weight: 600;
        color: #1a1a1a;
    }

    .executive-grid {
        display: grid;
        grid-template-columns: 1fr 1fr auto;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .metric-card {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        display: flex;
        gap: 1.5rem;
    }

    .metric-icon {
        width: 50px;
        height: 50px;
        background: #f3f4f6;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: #6b7280;
    }

    .metric-content {
        flex: 1;
    }

    .metric-label {
        font-size: 0.75rem;
        color: #9ca3af;
        letter-spacing: 0.5px;
        margin-bottom: 0.75rem;
    }

    .metric-value {
        font-size: 2.5rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 0.5rem;
        line-height: 1;
    }

    .metric-change {
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .metric-change.positive {
        color: #10b981;
    }

    .metric-change.negative {
        color: #ef4444;
    }

    .metrics-sidebar {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        display: flex;
        flex-direction: column;
        gap: 2rem;
        min-width: 250px;
    }

    .sidebar-metric {
        text-align: right;
    }

    .sidebar-label {
        font-size: 0.75rem;
        color: #9ca3af;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
    }

    .sidebar-value {
        font-size: 2rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 0.25rem;
    }

    .sidebar-comparison {
        font-size: 0.85rem;
        color: #6b7280;
    }

    .status-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        margin-bottom: 2rem;
        font-size: 0.9rem;
        color: #6b7280;
    }

    .operational-health {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .health-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #10b981;
    }

    .growth-section {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }

    .growth-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    .growth-title {
        font-size: 0.75rem;
        color: #9ca3af;
        letter-spacing: 0.5px;
    }

    .growth-icon {
        color: #9ca3af;
    }

    .growth-content {
        display: flex;
        flex-direction: column;
    }

    .growth-value {
        font-size: 3rem;
        font-weight: 600;
        color: #10b981;
        margin-bottom: 0.5rem;
    }

    .growth-label {
        font-size: 1.1rem;
        color: #1a1a1a;
        margin-bottom: 0.5rem;
    }

    .growth-subtext {
        font-size: 0.9rem;
        color: #9ca3af;
    }

    @@media (max-width: 1200px) {
        .executive-grid {
            grid-template-columns: 1fr;
        }

        .metrics-sidebar {
            flex-direction: row;
        }

        .sidebar-metric {
            text-align: left;
            flex: 1;
        }
    }
</style>
